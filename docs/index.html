<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gift Manager</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap topbar-inner">
      <div class="brand">
        <div class="logo">GM</div>
        <div>
          <div class="brand-name">Gift Manager</div>
          <div class="brand-sub">投げ銭ログ / 返礼タスク（ブラウザ保存）</div>
        </div>
      </div>

      <nav class="nav">
        <a href="#home" class="navlink" data-nav="home">ホーム</a>
        <a href="#tasks" class="navlink" data-nav="tasks">タスク管理</a>
        <a href="#campaigns" class="navlink" data-nav="campaigns">企画作成</a>
      </nav>

      <div class="actions">
        <button id="exportBtn" class="btn ghost" type="button">バックアップ</button>
        <label class="btn ghost filebtn">
          復元
          <input id="importFile" type="file" accept="application/json" hidden />
        </label>
      </div>
    </div>
  </header>

  <!-- ===== HOME ===== -->
  <main id="view-home" class="wrap stack">
    <section class="hero">
      <div class="hero-title">最初にやりたいことを選ぶ</div>
      <div class="hero-sub">配信中はタスク確認・配信後は企画作成とログ入力、みたいに使い分け</div>

      <div class="choice-grid">
        <a class="choice-card" href="#tasks">
          <div class="choice-icon">✅</div>
          <div class="choice-main">タスク管理</div>
          <div class="choice-sub">漏れゼロに寄せる。未完了を一望して、移動・完了。</div>
        </a>

        <a class="choice-card" href="#campaigns">
          <div class="choice-icon">📌</div>
          <div class="choice-main">企画作成</div>
          <div class="choice-sub">企画を作って、投げ銭を入力→合計と順位を即確認。</div>
        </a>
      </div>
    </section>

    <section class="grid2">
      <section class="card">
        <div class="card-head">
          <div class="card-title">今の状況</div>
          <div class="pill" id="overallPill">—</div>
        </div>
        <div class="stats">
          <div class="stat">
            <div class="stat-num" id="statCampaigns">0</div>
            <div class="stat-label">企画</div>
          </div>
          <div class="stat">
            <div class="stat-num" id="statTasksOpen">0</div>
            <div class="stat-label">未完了タスク</div>
          </div>
          <div class="stat">
            <div class="stat-num" id="statTasksDone">0</div>
            <div class="stat-label">完了タスク</div>
          </div>
        </div>
        <div class="muted">※ データはこのブラウザに保存。端末やブラウザを変えると同期されない。</div>
      </section>

      <section class="card">
        <div class="card-head">
          <div class="card-title">クイック操作</div>
          <div class="muted">よく使う操作を最短に</div>
        </div>
        <div class="stack">
          <button class="btn primary" id="quickNewTask">タスクをすぐ追加</button>
          <button class="btn" id="quickNewCampaign">企画をすぐ作成</button>
        </div>
      </section>
    </section>
  </main>

  <!-- ===== TASK HUB ===== -->
  <main id="view-tasks" class="wrap stack hidden">
    <section class="pagehead">
      <div>
        <div class="h1">タスク管理</div>
        <div class="muted">企画を跨いで“未完了”を潰す画面</div>
      </div>
      <div class="row gap">
        <input id="taskSearch" class="input" placeholder="検索：リスナー名 / タスク内容 / 企画名" />
        <select id="taskFilter" class="input">
          <option value="open">未完了のみ</option>
          <option value="all">すべて</option>
        </select>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div class="card-title">タスク追加</div>
        <div class="muted">企画なしでもOK（“タスクだけ管理”運用対応）</div>
      </div>
      <form id="taskHubForm" class="grid3">
        <label class="field">
          <span>企画（任意）</span>
          <select name="campaign_id" id="taskHubCampaign" class="input"></select>
        </label>
        <label class="field">
          <span>リスナー名</span>
          <input name="listener_name" class="input" required placeholder="例：Alice" />
        </label>
        <label class="field">
          <span>内容</span>
          <input name="title" class="input" required placeholder="例：デジ送付 / 住所回収 / 梱包" />
        </label>
        <label class="field">
          <span>状態</span>
          <select name="status" class="input">
            <option value="todo">未着手</option>
            <option value="waiting">必要情報待ち</option>
            <option value="doing">制作/準備中</option>
            <option value="ship">納品/発送待ち</option>
            <option value="done">完了</option>
          </select>
        </label>
        <div class="field">
          <span>&nbsp;</span>
          <button class="btn primary" type="submit">追加</button>
        </div>
      </form>
    </section>

    <section class="card">
      <div class="card-head">
        <div class="card-title">ボード</div>
        <div class="muted">ボタンで状態移動（ドラッグ無しでも迷わない）</div>
      </div>
      <div id="taskHubBoard" class="kanban"></div>
    </section>
  </main>

  <!-- ===== CAMPAIGNS ===== -->
  <main id="view-campaigns" class="wrap stack hidden">
    <section class="pagehead">
      <div>
        <div class="h1">企画作成</div>
        <div class="muted">企画を作って管理（単日/期間、内部入力/外部集計）</div>
      </div>
      <div class="row gap">
        <input id="campaignSearch" class="input" placeholder="企画名で検索" />
        <a class="btn primary" href="#campaigns" id="scrollToCreate">企画を作る</a>
      </div>
    </section>

    <section class="grid2">
      <section class="card">
        <div class="card-head">
          <div class="card-title">企画一覧</div>
          <div class="muted">✅=未完了なし / 🔴=未完了タスクあり</div>
        </div>
        <div id="campaignList" class="list"></div>
      </section>

      <section class="card" id="createCampaignCard">
        <div class="card-head">
          <div class="card-title">新規企画</div>
          <div class="muted">まずは企画を作る。あとから入力すればOK。</div>
        </div>
        <form id="createCampaignForm" class="grid2">
          <label class="field">
            <span>企画名</span>
            <input class="input" name="name" required placeholder="例：2月デジグッズ企画" />
          </label>

          <label class="field">
            <span>日付モード</span>
            <select class="input" name="date_mode" id="date_mode">
              <option value="single">単日</option>
              <option value="range">期間</option>
            </select>
          </label>

          <label class="field">
            <span>開始日</span>
            <input class="input" type="date" name="start_date" required />
          </label>

          <label class="field" id="endDateWrap" style="display:none;">
            <span>終了日</span>
            <input class="input" type="date" name="end_date" />
          </label>

          <label class="field">
            <span>集計ソース</span>
            <select class="input" name="source_mode">
              <option value="internal">内部入力（ライブ入力）</option>
              <option value="external">外部集計（CSV貼り付け）</option>
            </select>
          </label>

          <div class="field">
            <span>&nbsp;</span>
            <button class="btn primary" type="submit">作成</button>
          </div>
        </form>
      </section>
    </section>
  </main>

  <!-- ===== CAMPAIGN DETAIL ===== -->
  <main id="view-campaign" class="wrap stack hidden">
    <section class="pagehead">
      <div>
        <div class="row gap">
          <a class="btn ghost" href="#campaigns">← 企画一覧</a>
          <div class="pill" id="campaignStatusPill">—</div>
        </div>
        <div class="h1" id="campaignTitle"></div>
        <div class="muted" id="campaignMeta"></div>
      </div>
      <button id="deleteCampaignBtn" class="btn danger" type="button">企画削除</button>
    </section>

    <section class="grid2 top">
      <section class="card">
        <div class="card-head">
          <div class="card-title">リーダーボード</div>
          <div class="muted">入力すると即反映</div>
        </div>
        <table class="table">
          <thead><tr><th>名前</th><th class="right">合計pt</th></tr></thead>
          <tbody id="leaderboardBody"></tbody>
        </table>
      </section>

      <section class="card" id="liveCard">
        <div class="card-head">
          <div class="card-title">ライブ入力（内部入力）</div>
          <div class="muted">加算ボタン + Undo で誤入力を潰す</div>
        </div>

        <div class="stack">
          <label class="field">
            <span>リスナー名</span>
            <input id="listenerName" class="input" placeholder="表示名" />
          </label>

          <div class="row wrapBtns">
            <button class="btn" type="button" data-add="100">+100</button>
            <button class="btn" type="button" data-add="300">+300</button>
            <button class="btn" type="button" data-add="500">+500</button>
            <button class="btn" type="button" data-add="1000">+1000</button>
          </div>

          <div class="row gap">
            <input id="customPoints" class="input" type="number" placeholder="任意pt" />
            <button id="addCustomBtn" class="btn primary" type="button">加算</button>
          </div>

          <div class="row gap">
            <button id="undoBtn" class="btn ghost" type="button">Undo（直近1件）</button>
            <button id="subtractBtn" class="btn ghost" type="button">減算（訂正）</button>
          </div>

          <div id="liveMsg" class="muted"></div>
        </div>
      </section>

      <section class="card hidden" id="externalCard">
        <div class="card-head">
          <div class="card-title">外部集計（CSV貼り付け）</div>
          <div class="muted">形式：name,total_points（ヘッダー不要）</div>
        </div>
        <textarea id="csvText" class="textarea" rows="10" placeholder="例：
Alice,1200
Bob,3000"></textarea>
        <div class="row gap">
          <button id="importCsvBtn" class="btn primary" type="button">取り込み/更新</button>
          <button id="clearExternalBtn" class="btn ghost" type="button">外部集計クリア</button>
        </div>
      </section>
    </section>

    <section class="card">
      <div class="card-head">
        <div class="card-title">タスク</div>
        <div class="muted">ここが漏れ防止の本体</div>
      </div>

      <form id="createTaskForm" class="grid3">
        <label class="field">
          <span>リスナー名</span>
          <input name="listener_name" class="input" required placeholder="例：Alice" />
        </label>
        <label class="field">
          <span>内容</span>
          <input name="title" class="input" required placeholder="例：デジ送付 / 住所回収 / 梱包" />
        </label>
        <label class="field">
          <span>状態</span>
          <select name="status" class="input">
            <option value="todo">未着手</option>
            <option value="waiting">必要情報待ち</option>
            <option value="doing">制作/準備中</option>
            <option value="ship">納品/発送待ち</option>
            <option value="done">完了</option>
          </select>
        </label>
        <div class="field">
          <span>&nbsp;</span>
          <button class="btn primary" type="submit">追加</button>
        </div>
      </form>

      <div id="kanban" class="kanban"></div>
    </section>
  </main>

  <div id="toast" class="toast hidden"></div>
  <script src="./app.js"></script>
</body>
</html>
