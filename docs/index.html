<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gift Manager</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap row space-between">
      <div>
        <div class="brand">Gift Manager</div>
        <div class="muted">GitHub Pages / ブラウザ保存（この端末のこのブラウザに残る）</div>
      </div>
      <div class="row gap-sm">
        <button id="exportBtn" class="btn secondary" type="button">バックアップ</button>
        <label class="btn secondary filebtn">
          復元
          <input id="importFile" type="file" accept="application/json" hidden />
        </label>
      </div>
    </div>
  </header>

  <!-- ===== 一覧 ===== -->
  <main id="view-list" class="wrap stack">
    <section class="card">
      <div class="row space-between">
        <h2 class="h2">企画一覧</h2>
        <input id="searchCampaign" class="input" placeholder="企画名で検索" />
      </div>
      <div id="campaignList" class="list"></div>
      <div class="muted">✅=未完了なし / 🔴=未完了タスクあり</div>
    </section>

    <section class="card">
      <h2 class="h2">企画作成</h2>
      <form id="createCampaignForm" class="grid2">
        <label class="field">
          <span>企画名</span>
          <input class="input" name="name" required placeholder="例：2月デジグッズ企画" />
        </label>

        <label class="field">
          <span>日付モード</span>
          <select class="input" name="date_mode" id="date_mode">
            <option value="single">単日</option>
            <option value="range">期間</option>
          </select>
        </label>

        <label class="field">
          <span>開始日</span>
          <input class="input" type="date" name="start_date" required />
        </label>

        <label class="field" id="endDateWrap" style="display:none;">
          <span>終了日</span>
          <input class="input" type="date" name="end_date" />
        </label>

        <label class="field">
          <span>集計ソース</span>
          <select class="input" name="source_mode">
            <option value="internal">内部入力（ライブ入力）</option>
            <option value="external">外部集計（CSV貼り付け）</option>
          </select>
        </label>

        <div class="field">
          <span>&nbsp;</span>
          <button class="btn primary" type="submit">作成</button>
        </div>
      </form>
    </section>
  </main>

  <!-- ===== 詳細 ===== -->
  <main id="view-campaign" class="wrap stack hidden">
    <section class="card">
      <div class="row space-between">
        <div>
          <div class="row gap-sm">
            <button id="backBtn" class="btn secondary" type="button">← 企画一覧</button>
            <span id="statusIcon" class="statusIcon">✅</span>
          </div>
          <h2 id="campaignTitle" class="h2" style="margin-top:8px;"></h2>
          <div id="campaignMeta" class="muted"></div>
        </div>
        <button id="deleteCampaignBtn" class="btn danger" type="button">企画削除</button>
      </div>
    </section>

    <section class="grid2 top">
      <section class="card">
        <h3 class="h3">リーダーボード</h3>
        <div class="muted">入力すると即反映</div>
        <table class="table">
          <thead><tr><th>名前</th><th class="right">合計pt</th></tr></thead>
          <tbody id="leaderboardBody"></tbody>
        </table>
      </section>

      <section class="card" id="liveCard">
        <h3 class="h3">ライブ入力（内部入力）</h3>
        <div class="stack">
          <label class="field">
            <span>リスナー名</span>
            <input id="listenerName" class="input" placeholder="表示名" />
          </label>

          <div class="row wrapBtns">
            <button class="btn secondary" type="button" data-add="100">+100</button>
            <button class="btn secondary" type="button" data-add="300">+300</button>
            <button class="btn secondary" type="button" data-add="500">+500</button>
            <button class="btn secondary" type="button" data-add="1000">+1000</button>
          </div>

          <div class="row gap-sm">
            <input id="customPoints" class="input" type="number" placeholder="任意pt" />
            <button id="addCustomBtn" class="btn primary" type="button">加算</button>
          </div>

          <div class="row gap-sm">
            <button id="undoBtn" class="btn secondary" type="button">Undo（直近1件）</button>
            <button id="subtractBtn" class="btn secondary" type="button">減算（訂正）</button>
          </div>

          <div id="liveMsg" class="muted"></div>
        </div>
      </section>

      <section class="card hidden" id="externalCard">
        <h3 class="h3">外部集計（CSV貼り付け）</h3>
        <div class="muted">形式：name,total_points（ヘッダー不要）</div>
        <textarea id="csvText" class="textarea" rows="10" placeholder="例：
Alice,1200
Bob,3000"></textarea>
        <div class="row gap-sm">
          <button id="importCsvBtn" class="btn primary" type="button">取り込み/更新</button>
          <button id="clearExternalBtn" class="btn secondary" type="button">外部集計クリア</button>
        </div>
      </section>
    </section>

    <section class="card">
      <div class="row space-between">
        <h3 class="h3">タスク</h3>
        <div class="muted">漏れ防止の中核。未完了が残ると一覧が🔴になる。</div>
      </div>

      <form id="createTaskForm" class="row gap-sm taskForm">
        <input name="listener_name" class="input" placeholder="リスナー名" required />
        <input name="title" class="input" placeholder="例：デジ送付 / 住所回収 / 梱包" required />
        <select name="status" class="input">
          <option value="todo">未着手</option>
          <option value="waiting">必要情報待ち</option>
          <option value="doing">制作/準備中</option>
          <option value="ship">納品/発送待ち</option>
          <option value="done">完了</option>
        </select>
        <button class="btn primary" type="submit">追加</button>
      </form>

      <div id="kanban" class="kanban"></div>
    </section>
  </main>

  <div id="toast" class="toast hidden"></div>

  <script src="./app.js"></script>
</body>
</html>
